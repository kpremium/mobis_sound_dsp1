
#include "common.h"
#include <sru21569.h>
#include "DRV_DAI.h"


static void Disable_DAI_SRU(void)
{
	SRU(LOW, DAI0_PB01_I);
	SRU(LOW, DAI0_PB02_I);
	SRU(LOW, DAI0_PB03_I);
	SRU(LOW, DAI0_PB04_I);
	SRU(LOW, DAI0_PB05_I);
	SRU(LOW, DAI0_PB06_I);
	SRU(LOW, DAI0_PB07_I);
	SRU(LOW, DAI0_PB08_I);
	SRU(LOW, DAI0_PB09_I);
	SRU(LOW, DAI0_PB10_I);
	SRU(LOW, DAI0_PB11_I);
	SRU(LOW, DAI0_PB12_I);
	SRU(LOW, DAI0_PB19_I);
	SRU(LOW, DAI0_PB20_I);
	SRU2(LOW, DAI1_PB01_I);
	SRU2(LOW, DAI1_PB02_I);
	SRU2(LOW, DAI1_PB03_I);
	SRU2(LOW, DAI1_PB04_I);
	SRU2(LOW, DAI1_PB05_I);
	SRU2(LOW, DAI1_PB06_I);
	SRU2(LOW, DAI1_PB07_I);
	SRU2(LOW, DAI1_PB08_I);
	SRU2(LOW, DAI1_PB09_I);
	SRU2(LOW, DAI1_PB10_I);
	SRU2(LOW, DAI1_PB11_I);
	SRU2(LOW, DAI1_PB12_I);
	SRU2(LOW, DAI1_PB19_I);
	SRU2(LOW, DAI1_PB20_I);

	SRU(LOW, DAI0_PBEN01_I);
	SRU(LOW, DAI0_PBEN02_I);
	SRU(LOW, DAI0_PBEN03_I);
	SRU(LOW, DAI0_PBEN04_I);
	SRU(LOW, DAI0_PBEN05_I);
	SRU(LOW, DAI0_PBEN06_I);
	SRU(LOW, DAI0_PBEN07_I);
	SRU(LOW, DAI0_PBEN08_I);
	SRU(LOW, DAI0_PBEN09_I);
	SRU(LOW, DAI0_PBEN10_I);
	SRU(LOW, DAI0_PBEN11_I);
	SRU(LOW, DAI0_PBEN12_I);
	SRU(LOW, DAI0_PBEN19_I);
	SRU(LOW, DAI0_PBEN20_I);
	SRU2(LOW, DAI1_PBEN01_I);
	SRU2(LOW, DAI1_PBEN02_I);
	SRU2(LOW, DAI1_PBEN03_I);
	SRU2(LOW, DAI1_PBEN04_I);
	SRU2(LOW, DAI1_PBEN05_I);
	SRU2(LOW, DAI1_PBEN06_I);
	SRU2(LOW, DAI1_PBEN07_I);
	SRU2(LOW, DAI1_PBEN08_I);
	SRU2(LOW, DAI1_PBEN09_I);
	SRU2(LOW, DAI1_PBEN11_I);
	SRU2(LOW, DAI1_PBEN12_I);
	SRU2(LOW, DAI1_PBEN10_I);
	SRU2(LOW, DAI1_PBEN19_I);
	SRU2(LOW, DAI1_PBEN20_I);
}

static void Setup_DAI_SRU(void)
{
	/* Signal Routing for A2B Slave */
	/*
	 * DAI0_PIN03 <- BCLK@48kHz, TDM16
	 * DAI0_PIN04 <- SYNC@48kHz, TDM16
	 * DAI0_PIN01 <- RX0(SPORT0A D0)
	 * DAI0_PIN02 <- RX1(SPORT0A D1)
	 * DAI0_PIN05 -> TX0(SPORT0B D0)
	 * DAI0_PIN06 -> TX1(SPORT0B D1)
	 */
	SRU(LOW,DAI0_PBEN03_I);			// BCLK
	SRU(LOW,DAI0_PBEN04_I);			// SYNC

	SRU(DAI0_PB03_O,SPT0_ACLK_I);	// BCLK
	SRU(DAI0_PB04_O,SPT0_AFS_I);	// SYNC

	/* DATA IN0 */
	SRU(LOW,DAI0_PBEN01_I);			// RX0
	SRU(DAI0_PB01_O,SPT0_AD0_I);	// RX0

	/* DATA IN1 */
	//SRU(LOW,DAI0_PBEN02_I);			// RX1
	//SRU(DAI0_PB02_O,SPT0_AD1_I);	// RX1
 
#if (USE_DSP_CFG == 0u)
	SRU(DAI0_PB03_O,SPT0_BCLK_I);	// BCLK
	SRU(DAI0_PB04_O,SPT0_BFS_I);	// SYNC

	/* DATA OUT0 */
	SRU(HIGH,DAI0_PBEN05_I);		// TX0
	SRU(SPT0_BD0_O,DAI0_PB05_I);	// TX0

	/* DATA OUT1 */
	//SRU(HIGH,DAI0_PBEN06_I);		// TX1
	//SRU(SPT0_BD1_O,DAI0_PB06_I);	// TX1
#endif

	/* Signal Routing for A2B#2 Master */
	/*
	 * DAI1_PIN03 -> BCLK@48kHz, TDM16
	 * DAI1_PIN04 -> FSCLK@48kHz, TDM16
	 * DAI1_PIN09 <- TX0 (SPORT5A D0 )
	 * DAI1_PIN10 <- TX1 (SPORT5B D0 )
	 */
#if 0
	SRU2(HIGH,DAI1_PBEN03_I);			// BCLK
	SRU2(HIGH,DAI1_PBEN04_I);			// SYNC
	SRU2(HIGH,DAI1_PBEN09_I);			// DTX0
	SRU2(HIGH,DAI1_PBEN10_I);			// DTX1

	SRU2(DAI1_CRS_PB03_O,DAI1_PB03_I);	// BCLK
	SRU2(DAI1_CRS_PB03_O,SPT5_ACLK_I);	// BCLK
	SRU2(DAI1_CRS_PB03_O,SPT5_BCLK_I);	// BCLK

	SRU2(DAI1_CRS_PB04_O,DAI1_PB04_I);	// SYNC
	SRU2(DAI1_CRS_PB04_O,SPT5_AFS_I);	// SYNC
	SRU2(DAI1_CRS_PB04_O,SPT5_BFS_I);	// SYNC

	SRU2(SPT5_AD0_O,DAI1_PB09_I);		// TX0
	SRU2(SPT5_BD0_O,DAI1_PB10_I);		// TX1
#endif
 
	/* Signal Routing for A2B#3 Master(PMIC) */
	/*
	 * DAI0_PIN19 -> BCLK@48kHz, TDM16
	 * DAI0_PIN20 -> FSCLK@48kHz, TDM16
	 * DAI0_PIN09 <- RX0 (SPORT3A D0 )
	 * DAI0_PIN10 <- RX1 (SPORT3B D0)
	 */
	SRU(HIGH,DAI0_PBEN19_I);		// BCLK
	SRU(HIGH,DAI0_PBEN20_I);		// SYNC
	SRU(LOW,DAI0_PBEN09_I);			// DRX0
	SRU(LOW,DAI0_PBEN10_I);			// DRX1

	SRU(DAI0_PB03_O,DAI0_PB19_I);	// BCLK
	SRU(DAI0_PB04_O,DAI0_PB20_I);	// SYNC

	SRU(DAI0_PB19_O,SPT3_ACLK_I);	// BCLK
	SRU(DAI0_PB19_O,SPT3_BCLK_I);	// BCLK

	SRU(DAI0_PB20_O,SPT3_AFS_I);	// SYNC
	SRU(DAI0_PB20_O,SPT3_BFS_I);	// SYNC

	SRU(DAI0_PB09_O,SPT3_AD0_I);	// DRX0
	SRU(DAI0_PB10_O,SPT3_BD0_I);	// DRX1

	/* Signal Routing for A2B#4 Master(ACC) */
	/*
	 * DAI0_PIN19 -> BCLK@48kHz, TDM16
	 * DAI0_PIN20 -> FSCLK@48kHz, TDM16
	 * DAI0_PIN11 <- RX0 (SPORT2A D0)
	 * DAI0_PIN12 <- RX1 (SPORT2B D0)
	 */
	SRU(LOW,DAI0_PBEN11_I);			// DRX0
	SRU(LOW,DAI0_PBEN12_I);			// DRX1

	SRU(DAI0_PB19_O,SPT2_ACLK_I);	// BCLK
	SRU(DAI0_PB19_O,SPT2_BCLK_I);	// BCLK

	SRU(DAI0_PB20_O,SPT2_AFS_I);	// SYNC
	SRU(DAI0_PB20_O,SPT2_BFS_I);	// SYNC

	SRU(DAI0_PB11_O,SPT2_AD0_I);	// DRX0
	SRU(DAI0_PB12_O,SPT2_BD0_I);	// DRX1

#if (USE_DSP_CFG == 1u)
	/* Signal Routing for DSP2 */
	/*
	 * DAI1_PIN05 -> BCLK@48kHz, TDM16
	 * DAI1_PIN06 -> FSCLK@48kHz, TDM16
	 * DAI1_PIN01 <- TX0 (SPORT4A D0 )
	 * DAI1_PIN02 <- TX1 (SPORT4A D1)
	 * DAI1_PIN07 <- RX0 (SPORT4B D0)
	 * DAI1_PIN08 <- RX1 (SPORT4B D1)
	 */
	SRU2(HIGH,DAI1_PBEN05_I);			// BCLK
	SRU2(HIGH,DAI1_PBEN06_I);			// FSCLK
	SRU2(HIGH,DAI1_PBEN01_I);			// DTX0
	SRU2(HIGH,DAI1_PBEN02_I);			// DTX1
	SRU2(LOW,DAI1_PBEN07_I);			// DRX0
	SRU2(LOW,DAI1_PBEN08_I);			// DRX1

	SRU2(DAI1_CRS_PB03_O,DAI1_PB05_I);	// BCLK
	SRU2(DAI1_PB05_O,SPT4_ACLK_I);		// BCLK
	SRU2(DAI1_PB05_O,SPT4_BCLK_I);		// BCLK

	SRU2(DAI1_CRS_PB04_O,DAI1_PB06_I);	// FSCLK
	SRU2(DAI1_PB06_O,SPT4_AFS_I);		// FSCLK
	SRU2(DAI1_PB06_O,SPT4_BFS_I);		// FSCLK

	SRU2(SPT4_AD0_O,DAI1_PB01_I);		// DTX0
	SRU2(SPT4_AD1_O,DAI1_PB02_I);		// DTX0

	SRU2(DAI1_PB07_O,SPT4_BD0_I);		// DRX0
	SRU2(DAI1_PB08_O,SPT4_BD1_I);		// DRX1
#endif

	/* for Camping Mode */
	/*
	 * SPORT6B -> SRC4 IP -> SRC4 OP -> SPORT7B
	 */
	// External Audio Reference Clock Input : 24.576MHz
	SRU2(DAI1_CRS_PB03_O, PCG0_EXTCLKC_I);

	SRU2(PCG0_CLKC_O,SPT6_BCLK_I);	// BCLK
	SRU2(PCG0_FSC_O,SPT6_BFS_I);	// FSCLK
	SRU2(PCG0_CLKC_O,SRC4_CLK_IP_I);// BCLK
	SRU2(PCG0_FSC_O,SRC4_FS_IP_I);	// FSCLK
	SRU2(SPT6_BD0_O, SRC4_DAT_IP_I);// TX0

	SRU2(PCG0_CLKD_O,SPT7_BCLK_I);	// BCLK
	SRU2(PCG0_FSD_O,SPT7_BFS_I);	// FSCLK
	SRU2(PCG0_CLKD_O,SRC4_CLK_OP_I);// BCLK
	SRU2(PCG0_FSD_O,SRC4_FS_OP_I);	// FSCLK
	SRU2(SRC4_DAT_OP_O,SPT7_BD0_I);	// RX0

	/* Signal Routing for DAC */
	/*
	 * DAI1_PIN19 -> BCLK@48kHz, I2S
	 * DAI1_PIN20 -> FSCLK@48kHz, I2S
	 * DAI1_PIN12 <- TX0 (SPORT7A D0 )
	 * DAI1_PIN11 <- TX0 (SPORT6A D0 )
	 */

	SRU2(HIGH,DAI1_PBEN19_I);		// BCLK
	SRU2(HIGH,DAI1_PBEN20_I);		// FSCLK
	SRU2(HIGH,DAI1_PBEN12_I);		// DTX0
	SRU2(HIGH,DAI1_PBEN11_I);		// DTX0

	SRU2(PCG0_CLKD_O,DAI1_PB19_I);	// BCLK
	SRU2(PCG0_FSD_O,DAI1_PB20_I);	// FSCLK

	SRU2(DAI1_PB19_O,SPT7_ACLK_I);	// BCLK
	SRU2(DAI1_PB20_O,SPT7_AFS_I);	// FSCLK
	SRU2(SPT7_AD0_O,DAI1_PB12_I);	// TX0

	SRU2(DAI1_PB19_O,SPT6_ACLK_I);	// BCLK
	SRU2(DAI1_PB20_O,SPT6_AFS_I);	// FSCLK
	SRU2(SPT6_AD0_O,DAI1_PB11_I);	// TX0

#if (EZ_KIT_BOARD == 1u)
	/* Signal Routing for DSP2 */
	/*
	 * DAI1_PIN07 -> BCLK@48kHz, TDM16
	 * DAI1_PIN08 -> FSCLK@48kHz, TDM16
	 * DAI1_PIN09 <- TX0 (SPORT4A D0 )
	 * DAI1_PIN09 <- TX1 (SPORT4A D1)
	 * DAI1_PIN01 <- RX0 (SPORT4B D0)
	 * DAI1_PIN01 <- RX1 (SPORT4B D1)
	 */

	SRU2(HIGH,DAI1_PBEN07_I);		// BCLK
	SRU2(HIGH,DAI1_PBEN08_I);		// FSCLK
	SRU2(HIGH,DAI1_PBEN09_I);		// DTX0
	SRU2(LOW,DAI1_PBEN11_I);		// DRX0

	SRU2(DAI1_CRS_PB03_O,DAI1_PB07_I);	// BCLK
	SRU2(DAI1_PB07_O,SPT4_ACLK_I);	// BCLK
	SRU2(DAI1_PB07_O,SPT4_BCLK_I);	// BCLK

	SRU2(DAI1_CRS_PB04_O,DAI1_PB08_I);	// FSCLK
	SRU2(DAI1_PB08_O,SPT4_AFS_I);	// FSCLK
	SRU2(DAI1_PB08_O,SPT4_BFS_I);	// FSCLK

	SRU2(SPT4_AD0_O,DAI1_PB09_I);	// TX0
	SRU2(DAI1_PB11_O,SPT4_BD0_I);	// DRX0

	/* Signal Routing for DAC */
	/*
	 * DAI1_PIN05 -> BCLK@48kHz, TDM8
	 * DAI1_PIN04 -> FSCLK@48kHz, TDM8
	 * DAI1_PIN01 <- TX0 (SPORT7A D0 )
	 */
	SRU2(LOW, DAI1_PBEN03_I);
	SRU2(DAI1_PB03_O, PCG0_EXTCLKD_I);

	SRU2(HIGH,DAI1_PBEN04_I);		// FSCLK
	SRU2(PCG0_CLKD_O,DAI1_PB05_I);	// BCLK
	SRU2(PCG0_FSD_O,DAI1_PB04_I);	// FSCLK
	SRU2(SPT7_AD0_O,DAI1_PB01_I);	// TX0

	SRU(LOW,DAI0_PBEN07_I);		// BCLK
	SRU(LOW,DAI0_PBEN08_I);		// FSCLK
	SRU2(LOW,DAI1_PBEN12_I);
	SRU2(LOW,DAI1_PBEN20_I);
#endif
 }

static void DRV_DAI_InitPAD(void)
{
	/***********************************************/
	/******************** DAI 0 ********************/
	/***********************************************/
	*pREG_PADS0_DAI0_IE=0x000FFFFF;

	/***********************************************/
	/******************** DAI 1 ********************/
	/***********************************************/
	*pREG_PADS0_DAI1_IE=0x000FFFFF;
}

uint32_t DRV_DAI_InitSRU(void)
{
	// Disable all DAI pins
	Disable_DAI_SRU();

	// Initialize DAI pads
	DRV_DAI_InitPAD();

	// Setup used DAI pins
	Setup_DAI_SRU();

	return PASSED;
}

